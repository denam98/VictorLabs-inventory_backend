generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model user {
  user_id    String          @id @default(uuid())
  password   String
  email      String?         @unique
  username   String          @unique
  fname      String
  lname      String
  created_at DateTime        @default(now())
  updated_at DateTime        @updatedAt
  is_active  Boolean         @default(true)
  role_id    Int
  login      sys_login[]
  role       role            @relation(fields: [role_id], references: [role_id])
  activity   user_activity[]
}

model role {
  role_id    Int      @id @default(autoincrement())
  role_name  String
  created_at DateTime @default(now())
  is_active  Boolean  @default(true)
  users      user[]
}

model sys_login {
  id        Int      @id @default(autoincrement())
  timestamp DateTime
  user_id   String
  user      user     @relation(fields: [user_id], references: [user_id])
}

model activity_type {
  id            Int             @id @default(autoincrement())
  activity_name String
  activity      user_activity[]
}

model user_activity {
  id          Int           @id @default(autoincrement())
  timestamp   DateTime
  activity_id Int
  user_id     String
  record_id   String?
  activity    activity_type @relation(fields: [activity_id], references: [id])
  user        user          @relation(fields: [user_id], references: [user_id])
}

model rm_category {
  id           Int            @id @default(autoincrement())
  name         String
  is_active    Boolean        @default(true)
  raw_material raw_material[]
}

model uom {
  id           Int            @id @default(autoincrement())
  name         String
  is_active    Boolean        @default(true)
  raw_material raw_material[]
}

model raw_material {
  id             String        @id @default(uuid())
  name           String
  item_code      String
  is_active      Boolean       @default(true)
  is_inventory   Boolean       @default(true)
  created_at     DateTime      @default(now())
  updated_at     DateTime      @updatedAt
  uom_id         Int
  description    String?
  re_order_level String?
  re_order_qty   Decimal?
  rm_category_id Int
  grn_item       grn_item[]
  po_item        po_item[]
  prn_item       prn_item[]
  rm_category    rm_category   @relation(fields: [rm_category_id], references: [id])
  uom            uom           @relation(fields: [uom_id], references: [id])
  supplier       rm_supplier[]
  srn_item       srn_item[]
  product_costing_item product_costing_item[]
}

model supplier {
  id           String             @id @default(uuid())
  name         String
  br_number    String?
  created_at   DateTime           @default(now())
  updated_at   DateTime           @updatedAt
  is_active    Boolean            @default(true)
  address      String?
  fax          String?
  telephone    String?
  vat_reg_no   String?
  po           po[]
  raw_material rm_supplier[]
  contact      supplier_contact[]
}

model supplier_contact {
  id          Int      @id @default(autoincrement())
  telephone   String?
  email       String?
  mobile      String?
  is_active   Boolean  @default(true)
  supplier_id String
  name        String
  supplier    supplier @relation(fields: [supplier_id], references: [id])
}

model rm_supplier {
  id           Int          @id @default(autoincrement())
  rm_id        String
  supplier_id  String
  is_active    Boolean      @default(true)
  raw_material raw_material @relation(fields: [rm_id], references: [id])
  supplier     supplier     @relation(fields: [supplier_id], references: [id])
}

model priority {
  id   Int    @id @default(autoincrement())
  name String
  prn  prn[]
}

model prn {
  id           String     @id @default(uuid())
  requested_by String?
  remark       String?
  approved_by  String?
  created_at   DateTime   @default(now())
  is_active    Boolean    @default(true)
  priority_id  Int
  prn_no       String
  priority     priority   @relation(fields: [priority_id], references: [id])
  prn_item     prn_item[]
}

model prn_item {
  id                       String        @id @default(uuid())
  qty                      Decimal
  ordered_qty              Decimal       @default(0)
  estimated_price_per_unit Decimal
  is_active                Boolean       @default(true)
  prn_id                   String
  rm_id                    String
  prn                      prn           @relation(fields: [prn_id], references: [id])
  rm                       raw_material  @relation(fields: [rm_id], references: [id])
  prn_item_po              prn_item_po[]
  po_item                  po_item[]
}

model po {
  id                String        @id @default(uuid())
  special_note      String?
  delivery_location String
  deliver_before    DateTime?
  contact_person    String?
  currency          String        @default("LKR")
  state             String?
  is_active         Boolean       @default(true)
  discount_type     String
  discount          Decimal?
  supplier_id       String
  created_at        DateTime      @default(now())
  po_no             String?       @unique
  grn               grn?
  supplier          supplier      @relation(fields: [supplier_id], references: [id])
  po_item           po_item[]
  po_tax_type       po_tax_type[]
  prn_item_po       prn_item_po[]
}

model po_item {
  id             String       @id @default(uuid())
  qty            Decimal
  price_per_unit Decimal
  is_active      Boolean      @default(true)
  po_id          String
  rm_id          String
  prn_item_id    String?
  po             po           @relation(fields: [po_id], references: [id])
  prn_item       prn_item?    @relation(fields: [prn_item_id], references: [id])
  rm             raw_material @relation(fields: [rm_id], references: [id])
}

model prn_item_po {
  id          String   @id @default(uuid())
  is_active   Boolean  @default(true)
  prn_item_id String
  po_id       String
  po_item     po       @relation(fields: [po_id], references: [id])
  prn_item    prn_item @relation(fields: [prn_item_id], references: [id])
}

model grn {
  id              String         @id @default(uuid())
  grn_no          String         @unique
  comment         String?
  discount_type   String?
  discount        Decimal?
  supplier_inv_no String
  created_at      DateTime       @default(now())
  is_active       Boolean        @default(true)
  po_id           String         @unique
  po              po             @relation(fields: [po_id], references: [id])
  grn_item        grn_item[]
  grn_tax_type    grn_tax_type[]
  srn             srn?
}

model grn_item {
  id             String       @id @default(uuid())
  recieved_type  String
  qty            Decimal
  price_per_unit Decimal
  is_active      Boolean      @default(true)
  grn_id         String
  rm_id          String
  grn            grn          @relation(fields: [grn_id], references: [id])
  raw_material   raw_material @relation(fields: [rm_id], references: [id])
}

model srn {
  id           String         @id @default(uuid())
  srn_no       String         @unique
  comment      String?
  created_at   DateTime       @default(now())
  is_active    Boolean        @default(true)
  grn_id       String         @unique
  grn          grn            @relation(fields: [grn_id], references: [id])
  srn_item     srn_item[]
  srn_tax_type srn_tax_type[]
}

model srn_item {
  id           String       @id @default(uuid())
  qty          Decimal
  reason       String?
  discount     Decimal      @default(0)
  returned_by  String
  is_active    Boolean      @default(true)
  srn_id       String
  rm_id        String
  raw_material raw_material @relation(fields: [rm_id], references: [id])
  srn          srn          @relation(fields: [srn_id], references: [id])
}

model tax_type {
  id           Int            @id @default(autoincrement())
  name         String
  value        Decimal
  is_active    Boolean        @default(true)
  grn_tax_type grn_tax_type[]
  po_tax_type  po_tax_type[]
  srn_tax_type srn_tax_type[]
}

model po_tax_type {
  id          Int      @id @default(autoincrement())
  po_id       String
  tax_type_id Int
  po          po       @relation(fields: [po_id], references: [id])
  tax_type    tax_type @relation(fields: [tax_type_id], references: [id])
}

model srn_tax_type {
  id          Int      @id @default(autoincrement())
  srn_id      String
  tax_type_id Int
  srn         srn      @relation(fields: [srn_id], references: [id])
  tax_type    tax_type @relation(fields: [tax_type_id], references: [id])
}

model grn_tax_type {
  id          Int      @id @default(autoincrement())
  grn_id      String
  tax_type_id Int
  grn         grn      @relation(fields: [grn_id], references: [id])
  tax_type    tax_type @relation(fields: [tax_type_id], references: [id])
}

model customer {
  id String @id @default(uuid())
  name String
  type String
  code String
  vat Decimal
  website String
  telephone String
  email String
  address String
  credit_amount Decimal
  credit_period Int
  is_credit_allowed Boolean
  is_discount_allowed Boolean
  max_discount_percentage Decimal
  max_discount_value Decimal
  is_active Boolean @default(true)

  customer_contact customer_contact[]
}

model customer_contact {
  id Int @id @default(autoincrement())
  telephone String
  mobile String
  email String
  is_active Boolean @default(true)

  customer_id String
  customer customer @relation(fields: [customer_id], references: [id])
}

model batch {
  id String @id @default(uuid())
  name String
  start_date DateTime
  end_date DateTime
  is_complete Boolean
  batch_item batch_item[]
}

model batch_item {
  id Int @id @default(autoincrement())
  batch_id String
  rm_id String
  qty Decimal
  is_active    Boolean      @default(true)

  batch batch @relation(fields: [batch_id], references: [id])
}

model rm_issue {
  id String @id @default(uuid())
  batch_id String
  issue_note_no Int
  is_active    Boolean      @default(true)

  rm_issue_item rm_issue_item[]
}

model rm_issue_item {
  id Int @id @default(autoincrement())
  rm_issue_id String
  rm_id String
  qty Decimal
  issue_to String
  is_active    Boolean      @default(true)

  rm_issue rm_issue @relation(fields: [rm_issue_id], references: [id])
}

model product_category {
  id Int @id @default(autoincrement())
  name String
  code String
  is_active Boolean @default(true)
  product_sub_category product_sub_category[]
}

model product_sub_category {
  id Int @id @default(autoincrement())
  category_id Int
  name String
  code String
  is_active Boolean @default(true)
  product_category product_category @relation(fields: [category_id], references: [id])
  product product?
}

model product_costing_item {
  id Int @id @default(autoincrement())
  rm_id String
  qty Decimal
  raw_material raw_material @relation(fields: [rm_id], references: [id])
}

model product {
  id String @id @default(uuid())
  product_sub_category_id Int @unique
  name String
  code String
  description String
  uom_id Int
  is_customized Boolean @default(true)
  is_active Boolean @default(true)
  product_price_id Int @unique
  product_sub_category product_sub_category @relation(fields: [product_sub_category_id], references: [id])
  product_price product_price @relation(fields: [product_price_id], references: [id])
}

model product_price {
  id Int @id @default(autoincrement())
  product product?
  price Decimal
  reason_id Int @unique
  is_active Boolean @default(true)
  price_change_reason price_change_reason @relation(fields: [reason_id], references: [id])
}

model price_change_reason {
  id Int @id @default(autoincrement())
  reason_name String
  is_active Boolean @default(true)
  product_price product_price?
}